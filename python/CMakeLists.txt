cmake_minimum_required(VERSION 2.6)

# --- Find packages and libraries ---------------------------------------------
find_program(PYTHON "python")

if (PYTHON)
    option(WITH_PYTHON_TOOLS "Build Python tools module" ON)

    if (WITH_PYTHON_TOOLS)
        set(SETUP_PY_IN "${CMAKE_CURRENT_SOURCE_DIR}/setup.py.in")
        set(SETUP_PY    "${CMAKE_CURRENT_BINARY_DIR}/setup.py")
        set(DEPS        "${CMAKE_CURRENT_SOURCE_DIR}/ufonp.c")
        set(OUTPUT      "${CMAKE_CURRENT_BINARY_DIR}/build/timestamp")

        configure_file(${SETUP_PY_IN} ${SETUP_PY})

        add_custom_command(
            OUTPUT ${OUTPUT}
            COMMAND ${PYTHON} setup.py build
            COMMAND ${CMAKE_COMMAND} -E touch ${OUTPUT}
            DEPENDS ${DEPS}
            COMMENT "Build ufotools"
        )

        add_custom_target(ufotools ALL DEPENDS ${OUTPUT})

        install(CODE "execute_process(COMMAND ${PYTHON} ${SETUP_PY} install)")
    endif()
endif()
